<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <!-- InstantSearch CDN -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@meilisearch/instant-meilisearch/templates/basic_search.css" />
    <script src="https://cdn.jsdelivr.net/npm/@meilisearch/instant-meilisearch@0.3.2/dist/instant-meilisearch.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/instantsearch.js@4"></script>
    <!-- Bootstrap CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-F3w7mX95PdgyTmZZMECAngseQB83DfGTowi0iMjiWaeVhAn4FJkqJByhZMI3AhiU" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-/bQdsTh/da6pkI1MST/rWKFNjaCP5gBSY4sEBT38Q/9RBh9AH40zEOg7Hlq2THRZ" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.3/dist/umd/popper.min.js" integrity="sha384-W8fXfP3gkOKtndU4JGtKDvXbO53Wy8SZCQHczT5FMiiqmQfUpWbYdTil/SxwZgAN" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/js/bootstrap.min.js" integrity="sha384-skAcpIdS7UcVUC05LJ9Dxay8AXcDYfBJqt1CJ85S/CFujBsIzCIv+l9liuYLaMQ/" crossorigin="anonymous"></script>
    <!-- local css -->
    <link rel="stylesheet" href="./flip.css" />
  </head>
  <body>
    <div class="row">
      <div class="col-7"></div>
      <!-- searchBar is position: fixed -->
      <div class="col-7 searchBar">
        <div class="searchBox" id="searchbox"></div>
      </div>
      <div class="col-5" id="hits"></div>
    </div>
  </body>

  <style>
    body { font-family: sans-serif; padding: 1em; }
    .ais-SearchBox { margin: 1em 0; }
    li {
      list-style-type: none;
    }
  </style>
  <script>
    const search = instantsearch({
      // MeiliSearch Index name
      indexName: "podcast",
      // MeiliSearch Server url
      searchClient: instantMeiliSearch(
        "http://localhost:7700"
      )
    });

    search.addWidgets([
      instantsearch.widgets.searchBox({
        // html id of your searchbox
        container: "#searchbox",
        // what will appear when nothing is typed
        placeholder: "Search your podcast ...",
        // input auto focus (default false)
        autofocus: true,
        // searchAsYouType (default true)
        // showSubmit(button) (default true)
        // showLoadingIndicator (default false)
      }),
      instantsearch.widgets.configure({ 
        hitsPerPage: 5
      }),
      instantsearch.widgets.infiniteHits({
        container: "#hits",
        templates: {
          empty: 'No results for <q>{{ query }}</q>',
          showMoreText: `
          <div>
            <h4>show more results</h4>
          </div>`,
          item(hit){
            return`
              <div class="flipcard">
                <div class="flipcard-inner">
                  <div class="flipcard-front">
                    <div class="image">
                      <img src="${hit.poster}"/>
                    </div>
                    <div class="info">
                      <p class="hit-episode">
                        ${instantsearch.highlight({ attribute: 'episode_name', highlightedTagName: 'mark', hit })}
                      </p>
                      <p class="hit-publisher">
                        ${instantsearch.highlight({ attribute: 'publisher', highlightedTagName: 'mark', hit })}
                      </p>
                    </div>
                  </div>
                  <div class="flipcard-back">
                    <p class="hit-description">
                      ${hit.episode_description}
                    </p>
                  </div>
                </div>
              </div>`;
          }
        }
      })
    ]);
    search.start();
  </script>
</html>
